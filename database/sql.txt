CREATE DATABASE socket_subs;

CREATE TABLE contactos (
  id SERIAL PRIMARY KEY,
  cedula VARCHAR(20),
  nombre_apellido VARCHAR(255) NOT NULL,
  telefono VARCHAR(20),
  correo VARCHAR(255),
  ciudad VARCHAR(100),
  direccion VARCHAR(255),
  activo BOOLEAN NOT NULL DEFAULT FALSE,
  term_condi BOOLEAN NOT NULL DEFAULT FALSE,
  pagina VARCHAR(100),
    createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP, -- Fecha de creación (por defecto es la fecha actual)
    updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP -- Fecha de última actualización
);

CREATE TABLE envios_correo (
    id INT AUTO_INCREMENT PRIMARY KEY,
    asunto VARCHAR(255) NOT NULL,
    fecha_envio DATETIME NOT NULL,
    titulo_mensaje VARCHAR(255) NOT NULL,
    mensaje TEXT NOT NULL,
    habilitar_boton BOOLEAN DEFAULT FALSE,
    texto_boton VARCHAR(255),
    enlace_boton VARCHAR(255),
    habilitar_archivo BOOLEAN DEFAULT FALSE,
    ruta_archivo VARCHAR(255),
    habilitar_imagen BOOLEAN DEFAULT FALSE,
    ruta_imagen VARCHAR(255),
    enviar_por_correo BOOLEAN DEFAULT TRUE,
    enviar_por_whatsapp BOOLEAN DEFAULT FALSE,
    createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

CREATE TABLE usuarios (
  id INT AUTO_INCREMENT PRIMARY KEY,
  usuario VARCHAR(50) NOT NULL UNIQUE,
  pwd VARCHAR(255) NOT NULL,
  empresa VARCHAR(100) NOT NULL,
  logo VARCHAR(255) DEFAULT NULL,
  -- Configuración SMTP
  user_mail VARCHAR(100) DEFAULT NULL,
  password_mail VARCHAR(100) DEFAULT NULL,
  host_mail VARCHAR(100) DEFAULT NULL,
  port_mail INT DEFAULT NULL,
  nombre_empresa VARCHAR(100) DEFAULT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

INSERT INTO usuarios 
(usuario, pwd, empresa, logo, user_mail, password_mail, host_mail, port_mail, nombre_empresa)
VALUES
('consu_lapo', 'consu_lapo123', 'Consu Lapo', 'https://mislogos.com/consulapo.png',
 'facturaelect@misdocumentoselectronicos.com', 'M@rlon2025', 'smtp.hostinger.com', 465, 'SocketStudio'),

('agepro', 'agepro123', 'Agepro S.A.', 'https://mislogos.com/agepro.png',
 'facturaelect@misdocumentoselectronicos.com', 'M@rlon2025', 'smtp.hostinger.com', 465, 'SocketStudio');


CREATE TABLE envios_correo (
    id INT AUTO_INCREMENT PRIMARY KEY,              -- Identificador único para el envío
    asunto VARCHAR(255) NOT NULL,                   -- Título del correo
    fecha_envio DATETIME NOT NULL,                  -- Fecha y hora de envío
    titulo_mensaje VARCHAR(255) NOT NULL,           -- Título del mensaje
    mensaje TEXT NOT NULL,                          -- Cuerpo del mensaje
    habilitar_boton BOOLEAN DEFAULT FALSE,          -- Si se habilita el botón en el correo
    texto_boton VARCHAR(255),                       -- Texto del botón
    enlace_boton VARCHAR(255),                      -- Enlace del botón
    createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,  -- Fecha de creación
    updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP -- Fecha de última actualización
);

ALTER TABLE envios_correo
ADD COLUMN habilitar_archivo BOOLEAN DEFAULT FALSE,  -- Si se habilita la opción de cargar archivo
ADD COLUMN ruta_archivo VARCHAR(255);                -- Ruta donde se guarda el archivo

ALTER TABLE envios_correo
ADD COLUMN habilitar_imagen BOOLEAN DEFAULT FALSE,  -- Si se habilita la opción de cargar archivo
ADD COLUMN ruta_imagen VARCHAR(255);                -- Ruta donde se guarda el archivo

ALTER TABLE envios_correo 
MODIFY COLUMN mensaje TEXT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

ALTER TABLE envios_correo
ADD COLUMN enviar_por_correo BOOLEAN DEFAULT TRUE,
ADD COLUMN enviar_por_whatsapp BOOLEAN DEFAULT FALSE;